extends ../adminLayout
include ../stuff/mixins/form-helper
include ../stuff/adminIntarface/cards

append menuVars
  - var menuPage = 'places';
  - var menuSection = 'exams';

block content
    +listHeader('Рассадка')
    .row
        .col-xl-7
            .row
                +simpleCard('Рассадка по экзаменам', 12)
                    .table-responsive
                        table.table.table-hover
                            thead.text-primary
                                tr
                                    th 
                                    th Ready?
                                    th Show?
                                    th
                            tbody   
                                each examDate, index in examDates
                                    - var date = new Date(examDate)
                                    tr
                                        td #{index + 1} экзамен <b>(#{date.dayToString()}) #{date.format('dd.MM.yyyy')}</b>
                                        td yes
                                        td yes
                                        td 
                                            a.btn.btn-primary.btn-magnify(href='/admin/pupils/examseeds/seedApp/' + index)
                                                span.btn-label
                                                    i.fa.fa-random
                                                | #{'  '} Рассадить


                
                +simpleCard('Список мест', 12)
                    .text-right
                        +addNewDocBtn('Добавить место', '/admin/pupils/places/create')
                    .table-responsive
                        table.table.table-hover
                            thead.text-primary
                                tr
                                    th.text-center #
                                    th Код
                                    th Название / Адрес
                                    th Аудитории
                                    th.text-right Действия
                            tbody    
                                each doc, index in docs
                                    - var totalMax = 0;
                                    - for (var i = 0; i < doc.audience.length; i++) {
                                    -   totalMax += doc.audience[i].max
                                    - }
                                    tr
                                        td.text-center= index+1
                                        td  #{doc.code}
                                        td  
                                            each name in doc.name.split('&')
                                                p(style="margin-bottom:0") #{name}
                                            br
                                            p(style="margin-bottom:0") <b>Адрес:</b> 
                                            each address in doc.address.split('&')
                                                p(style="margin-bottom:0") #{address}
                                        td
                                            table.table
                                                - each audience in doc.audience
                                                    tr
                                                        td #{audience.name}
                                                        td #{audience.max}
                                                        td #{audience.bel ? 'Бел' :'  '}
                                                tr
                                                    td 
                                                        b Всего
                                                    td(colspan=2) 
                                                        b #{totalMax}
                                        td.text-right 
                                            a.btn.btn-success.btn-icon.btn-sm(href="/admin/pupils/places/edit/"+doc.id, type='button', rel='tooltip', data-original-title='Редактировать', title='Редактировать')
                                                i.fa.fa-edit
                                            | #{' '}    
                                            a.delete-doc-btn.btn.btn-danger.btn-icon.btn-sm(href="/admin/pupils/places/delete/"+doc.id, type='button', rel='tooltip', data-original-title='Удалить', title='Удалить')
                                                i.fa.fa-times      
        .col-xl-5
            .row
                +simpleCard('Дополнительно', 12)
                    //.form-group.text-right
                        a.btn.btn-warning(href='/admin/pupils/places/showSeats/1', disabled=siteConfig.showExamSeats1) Включить рассадку 1 экзамена
                        &nbsp;
                        a.btn.btn-warning(href='/admin/pupils/places/showSeats/2', disabled=siteConfig.showExamSeats2) Включить рассадку 2 экзамена
                        &nbsp;
                        a.btn.btn-danger(href='/admin/pupils/places/hideSeats') Скрыть рассадку
                    
                    h5 Данные для ручной массовой рассылки писем с аудиториями
                    .form-group.text-right
                        a.btn.btn-info(href='/admin/pupils/places/1/seats-email-export.csv') .csv для 1 экзамена 
                        &nbsp;
                        a.btn.btn-info(href='/admin/pupils/places/2/seats-email-export.csv') .csv для 2 экзамена 
            .row
                +simpleCard('Профили', 12, true)
                    .table-responsive
                        table.table.table-hover
                            thead.text-primary
                                tr
                                    th.text-center #
                                    th Название
                                    th Апрув.
                                    th Олимп.
                                    th Надо мест
                            tbody    
                                each profile, index in profiles
                                    tr
                                        td.text-center= index+1
                                        td #{profile.name}
                                        td #{profile.countArray[profile.countArray.length - 1].count}
                                        td #{profile.olymp}
                                        td
                                            b #{profile.countArray[profile.countArray.length - 1].count - profile.olymp}

                                        


