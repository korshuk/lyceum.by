extends ../adminLayout
include ../stuff/mixins/form-helper
include ../stuff/adminIntarface/cards

append menuVars
  - var menuPage = 'places';
  - var menuSection = 'exams';

block content
    +listHeader('Рассадка')
    .row
        .col-xl-7
            .row
                +simpleCard('Рассадка по экзаменам', 12)
                    .table-responsive
                        table.table.table-hover
                            thead.text-primary
                                tr
                                    th 
                                    th Ready?
                                    th Show?
                                    th
                            tbody   
                                each examDate, index in examDates
                                    - var date = new Date(examDate)
                                    tr
                                        td #{index + 1} экзамен <b>(#{date.dayToString()}) #{date.format('dd.MM.yyyy')}</b>
                                        td yes
                                        td yes
                                        td 
                                            a.btn.btn-primary.btn-magnify(href='/admin/pupils/examseeds/seedApp/' + index)
                                                span.btn-label
                                                    i.fa.fa-random
                                                | #{'  '} Рассадить


                
                +simpleCard('Список мест', 12)
                    .text-right
                        +addNewDocBtn('Добавить место', '/admin/pupils/places/create')
                    .table-responsive
                        table.table.table-hover
                            thead.text-primary
                                tr
                                    th.text-center #
                                    th Код
                                    th Название / Адрес / Аудитории
                                    th.text-right Действия
                            tbody    
                                each doc, index in docs
                                    - var totalMax = 0;
                                    - for (var i = 0; i < doc.audience.length; i++) {
                                    -   totalMax += doc.audience[i].max
                                    - }
                                    tr
                                        td.text-center= index+1
                                        td  #{doc.code}
                                        td 
                                            -var adressArray = doc.address.split('&');
                                            each name, index in doc.name.split('&')
                                                p(style="margin-bottom:0") <b>#{name}</b> #{adressArray[index]} 
                                                p(style="margin-bottom:0") Аудитории: 
                                                p
                                                    each audience in doc.audience
                                                        -var code = +audience.name.split('_')[0]
                                                        -var name = audience.name.split('_')[1]
                                                        if (code == index)
                                                            nobr(style="margin-right:10px") #{name}#{audience.bel ? ' Бел' :''} - <b>#{audience.max}</b>;
                                            p()
                                                b Всего #{totalMax}
                                               
                                        td.text-right 
                                            a.btn.btn-success.btn-icon.btn-sm(href="/admin/pupils/places/edit/"+doc.id, type='button', rel='tooltip', data-original-title='Редактировать', title='Редактировать')
                                                i.fa.fa-edit
                                            | #{' '}    
                                            a.delete-doc-btn.btn.btn-danger.btn-icon.btn-sm(href="/admin/pupils/places/delete/"+doc.id, type='button', rel='tooltip', data-original-title='Удалить', title='Удалить')
                                                i.fa.fa-times      
        .col-xl-5
            .row
                +simpleCard('Дополнительно', 12)
                    //.form-group.text-right
                        a.btn.btn-warning(href='/admin/pupils/places/showSeats/1', disabled=siteConfig.showExamSeats1) Включить рассадку 1 экзамена
                        &nbsp;
                        a.btn.btn-warning(href='/admin/pupils/places/showSeats/2', disabled=siteConfig.showExamSeats2) Включить рассадку 2 экзамена
                        &nbsp;
                        a.btn.btn-danger(href='/admin/pupils/places/hideSeats') Скрыть рассадку
                    
                    h5 Данные для ручной массовой рассылки писем с аудиториями
                    .form-group.text-right
                        a.btn.btn-info(href='/admin/pupils/places/1/seats-email-export.csv') .csv для 1 экзамена 
                        &nbsp;
                        a.btn.btn-info(href='/admin/pupils/places/2/seats-email-export.csv') .csv для 2 экзамена 
            .row
                +simpleCard('Профили', 12, true)
                    .table-responsive
                        table.table.table-hover
                            thead.text-primary
                                tr
                                    th.text-center #
                                    th Название
                                    th Надо мест
                            tbody    
                                each subject, index in subjects
                                    tr
                                        td.text-center= index+1
                                        td #{subject.name}
                                        td
                                            | #{JSON.stringify(lastStat.examsMap[subject.name])}
                                            //- b #{subject.countArray[subject.countArray.length - 1].count - subject.olymp}

                                        


